{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _jsxFileName = \"/Users/alvinneri/Desktop/Projects/PMS Mobile/property-management-mobile/employee-app/screens/maintenance/reportmaintenance.js\",\n    _this = this;\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { StatusBar } from \"expo-status-bar\";\nimport React, { useState } from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport { Camera } from \"expo-camera\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { useEffect } from \"react\";\nimport moment from \"moment\";\nimport firebase from \"../../firebase/config\";\nimport { db, storage } from \"../../firebase/config\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { setLoading } from \"../../redux/public/actions\";\nimport { useForm, Controller } from \"react-hook-form\";\nimport { useTheme, TextInput, Button } from \"react-native-paper\";\nimport { widthPercentageToDP as wp, heightPercentageToDP as hp } from \"react-native-responsive-screen\";\nimport Toast from \"react-native-toast-message\";\nimport { CarouselComponent } from \"../../components/carousel\";\nvar camera;\nexport default function ReportMaintenanceScreen() {\n  var _useTheme = useTheme(),\n      colors = _useTheme.colors;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      startCamera = _useState2[0],\n      setStartCamera = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      previewVisible = _useState4[0],\n      setPreviewVisible = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      capturedImage = _useState6[0],\n      setCapturedImage = _useState6[1];\n\n  var _useState7 = useState(Camera.Constants.Type.back),\n      _useState8 = _slicedToArray(_useState7, 2),\n      cameraType = _useState8[0],\n      setCameraType = _useState8[1];\n\n  var _useState9 = useState(\"off\"),\n      _useState10 = _slicedToArray(_useState9, 2),\n      flashMode = _useState10[0],\n      setFlashMode = _useState10[1];\n\n  var _useSelector = useSelector(function (state) {\n    return state.public;\n  }),\n      user = _useSelector.user;\n\n  var _useState11 = useState(\"\"),\n      _useState12 = _slicedToArray(_useState11, 2),\n      description = _useState12[0],\n      setDescription = _useState12[1];\n\n  var _useState13 = useState(\"\"),\n      _useState14 = _slicedToArray(_useState13, 2),\n      subject = _useState14[0],\n      setSubject = _useState14[1];\n\n  var _useState15 = useState([]),\n      _useState16 = _slicedToArray(_useState15, 2),\n      photos = _useState16[0],\n      setPhotos = _useState16[1];\n\n  var navigation = useNavigation();\n  var dispatch = useDispatch();\n\n  var __startCamera = function __startCamera() {\n    var _await$Camera$request, status;\n\n    return _regeneratorRuntime.async(function __startCamera$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(Camera.requestPermissionsAsync());\n\n          case 2:\n            _await$Camera$request = _context.sent;\n            status = _await$Camera$request.status;\n            console.log(status);\n\n            if (status === \"granted\") {\n              setStartCamera(true);\n            } else {\n              Alert.alert(\"Access denied\");\n            }\n\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var __takePicture = function __takePicture() {\n    var photo;\n    return _regeneratorRuntime.async(function __takePicture$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(camera.takePictureAsync());\n\n          case 2:\n            photo = _context2.sent;\n            setPreviewVisible(true);\n            setCapturedImage(photo);\n\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var __retakePicture = function __retakePicture() {\n    setCapturedImage(null);\n    setPreviewVisible(false);\n\n    __startCamera();\n  };\n\n  var __handleFlashMode = function __handleFlashMode() {\n    if (flashMode === \"on\") {\n      setFlashMode(\"off\");\n    } else if (flashMode === \"off\") {\n      setFlashMode(\"on\");\n    } else {\n      setFlashMode(\"auto\");\n    }\n  };\n\n  var __switchCamera = function __switchCamera() {\n    if (cameraType === \"back\") {\n      setCameraType(\"front\");\n    } else {\n      setCameraType(\"back\");\n    }\n  };\n\n  var __savePhoto = function __savePhoto() {\n    var _photos;\n\n    return _regeneratorRuntime.async(function __savePhoto$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            setPreviewVisible(false);\n            setStartCamera(false);\n            _photos = _toConsumableArray(photos);\n\n            _photos.push(capturedImage);\n\n            console.log(_photos);\n            setPhotos(_photos);\n\n          case 6:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var onSubmit = function onSubmit(values) {\n    var _downdloadUrls, date, filename;\n\n    return _regeneratorRuntime.async(function onSubmit$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            console.log(values);\n            dispatch(setLoading(true));\n\n            try {\n              _downdloadUrls = [];\n              date = new Date();\n              filename = date.getDate() + \"_\" + date.getMonth() + \"_\" + date.getFullYear() + \"_\" + date.getHours() + \"_\" + date.getMinutes() + \"_\" + date.getSeconds();\n              photos.forEach(function (item, index) {\n                fetch(item.uri).then(function (res) {\n                  return res.blob();\n                }).then(function (blob) {\n                  var file = new File([blob], \"File name\", {\n                    type: \"image/png\"\n                  });\n                  var uploadTask = storage.ref().child(\"/maintenance/\" + user.invitedBy + \"/\" + filename + \"_\" + index).put(file);\n                  uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, function (snapshot) {\n                    var progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n                    console.log(\"Progress: \" + progress + \"%\");\n\n                    if (snapshot.state === firebase.storage.TaskState.RUNNING) {\n                      console.log(\"file uploading...\");\n                    }\n                  }, function (error) {\n                    return console.log(error.code);\n                  }, function _callee() {\n                    var downloadURL, _values;\n\n                    return _regeneratorRuntime.async(function _callee$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            _context4.next = 2;\n                            return _regeneratorRuntime.awrap(uploadTask.snapshot.ref.getDownloadURL());\n\n                          case 2:\n                            downloadURL = _context4.sent;\n\n                            _downdloadUrls.push(downloadURL);\n\n                            if (index === photos.length - 1) {\n                              _values = {\n                                condoId: user.invitedBy.trim(),\n                                reporterUid: user.uid,\n                                reporterName: user.firstName + \" \" + user.lastName,\n                                subject: subject,\n                                description: description,\n                                image: _downdloadUrls,\n                                date: new Date(),\n                                status: \"OPEN\"\n                              };\n                              console.log(_values);\n                              db.collection(\"maintenance\").add(_values).then(function (docRef) {\n                                setStartCamera(false);\n                                setCapturedImage(null);\n                                setPhotos([]);\n                                setDescription(\"\");\n                                Toast.show({\n                                  position: \"bottom\",\n                                  text1: \"Report successfully submitted. \"\n                                });\n                                dispatch(setLoading(false));\n                              });\n                            }\n\n                          case 5:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, null, null, null, Promise);\n                  });\n                });\n              });\n            } catch (e) {\n              dispatch(setLoading(false));\n              console.log(e);\n            }\n\n          case 3:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return React.createElement(View, {\n    style: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 5\n    }\n  }, startCamera ? React.createElement(View, {\n    style: {\n      flex: 1,\n      width: \"100%\",\n      height: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 9\n    }\n  }, previewVisible && capturedImage ? React.createElement(CameraPreview, {\n    photo: capturedImage,\n    savePhoto: __savePhoto,\n    retakePicture: __retakePicture,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 13\n    }\n  }) : React.createElement(Camera, {\n    type: cameraType,\n    flashMode: flashMode,\n    style: {\n      flex: 1\n    },\n    ref: function ref(r) {\n      camera = r;\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 13\n    }\n  }, React.createElement(View, {\n    style: {\n      flex: 1,\n      width: \"100%\",\n      height: \"100%\",\n      backgroundColor: \"transparent\",\n      flexDirection: \"row\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 15\n    }\n  }, React.createElement(View, {\n    style: {\n      position: \"absolute\",\n      left: \"5%\",\n      top: \"10%\",\n      flexDirection: \"column\",\n      justifyContent: \"space-between\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 17\n    }\n  }, React.createElement(TouchableOpacity, {\n    onPress: __handleFlashMode,\n    style: {\n      backgroundColor: flashMode === \"off\" ? \"#000\" : \"#fff\",\n      borderRadius: \"50%\",\n      height: 25,\n      width: 25\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 19\n    }\n  }, React.createElement(Text, {\n    style: {\n      fontSize: 20\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 21\n    }\n  }, \"\\u26A1\\uFE0F\")), React.createElement(TouchableOpacity, {\n    onPress: __switchCamera,\n    style: {\n      marginTop: 20,\n      borderRadius: \"50%\",\n      height: 25,\n      width: 25\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 19\n    }\n  }, React.createElement(Text, {\n    style: {\n      fontSize: 20\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 21\n    }\n  }, cameraType === \"front\" ? \"🤳\" : \"📷\"))), React.createElement(View, {\n    style: {\n      position: \"absolute\",\n      bottom: 0,\n      flexDirection: \"row\",\n      flex: 1,\n      width: \"100%\",\n      padding: 20,\n      justifyContent: \"space-between\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 17\n    }\n  }, React.createElement(View, {\n    style: {\n      alignSelf: \"center\",\n      flex: 1,\n      alignItems: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 19\n    }\n  }, React.createElement(TouchableOpacity, {\n    onPress: __takePicture,\n    style: {\n      width: 70,\n      height: 70,\n      bottom: 0,\n      borderRadius: 50,\n      backgroundColor: \"#ffffff\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 21\n    }\n  })))))) : React.createElement(View, {\n    style: {\n      flex: 1,\n      alignItems: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 9\n    }\n  }, React.createElement(TextInput, {\n    autoCapitalize: \"none\",\n    name: \"Subject\",\n    mode: \"outlined\",\n    label: \"Subject\",\n    style: {\n      width: wp(\"95%\"),\n      marginBottom: 5,\n      padding: 10,\n      fontSize: 20\n    },\n    onChangeText: function onChangeText(value) {\n      return setSubject(value);\n    },\n    value: subject,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 11\n    }\n  }), React.createElement(TextInput, {\n    autoCapitalize: \"none\",\n    multiline: true,\n    name: \"Description\",\n    mode: \"outlined\",\n    label: \"Description\",\n    numberOfLines: 4,\n    style: {\n      height: hp(\"10%\"),\n      width: wp(\"95%\"),\n      marginBottom: 5,\n      padding: 10,\n      fontSize: 20\n    },\n    onChangeText: function onChangeText(value) {\n      return setDescription(value);\n    },\n    value: description,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 11\n    }\n  }), React.createElement(TouchableOpacity, {\n    onPress: __startCamera,\n    style: {\n      width: 130,\n      borderRadius: 4,\n      backgroundColor: colors.primary,\n      flexDirection: \"row\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      height: 40\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 11\n    }\n  }, React.createElement(Text, {\n    style: {\n      color: \"#fff\",\n      fontWeight: \"bold\",\n      textAlign: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 13\n    }\n  }, \"Take picture\"))), photos.length !== 0 && !previewVisible && !startCamera && React.createElement(React.Fragment, null, React.createElement(View, {\n    style: {\n      backgroundColor: \"transparent\",\n      width: \"100%\",\n      height: hp(\"40%\"),\n      justifyContent: \"center\",\n      alignContent: \"center\",\n      marginTop: 30,\n      alignItems: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 11\n    }\n  }, React.createElement(CarouselComponent, {\n    photos: photos,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 353,\n      columnNumber: 13\n    }\n  })), description && subject ? photos.length !== 0 ? React.createElement(Button, {\n    mode: \"outline\",\n    style: {\n      width: 300,\n      marginBottom: 10,\n      padding: 10,\n      backgroundColor: colors.primary\n    },\n    onPress: onSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 15\n    }\n  }, React.createElement(Text, {\n    style: {\n      color: \"#ffffff\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 367,\n      columnNumber: 17\n    }\n  }, \"SUBMIT\")) : null : null), React.createElement(StatusBar, {\n    style: \"auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 374,\n      columnNumber: 7\n    }\n  }));\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: \"#fff\",\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  }\n});\n\nvar CameraPreview = function CameraPreview(_ref) {\n  var photo = _ref.photo,\n      retakePicture = _ref.retakePicture,\n      savePhoto = _ref.savePhoto;\n  return React.createElement(View, {\n    style: {\n      backgroundColor: \"transparent\",\n      flex: 1,\n      width: \"100%\",\n      height: \"100%\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 390,\n      columnNumber: 5\n    }\n  }, React.createElement(ImageBackground, {\n    source: {\n      uri: photo && photo.uri\n    },\n    style: {\n      flex: 1\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 7\n    }\n  }, React.createElement(View, {\n    style: {\n      flex: 1,\n      flexDirection: \"column\",\n      padding: 15,\n      justifyContent: \"flex-end\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 404,\n      columnNumber: 9\n    }\n  }, React.createElement(View, {\n    style: {\n      flexDirection: \"row\",\n      justifyContent: \"space-between\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 11\n    }\n  }, React.createElement(TouchableOpacity, {\n    onPress: retakePicture,\n    style: {\n      width: 130,\n      height: 40,\n      alignItems: \"center\",\n      borderRadius: 4\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 418,\n      columnNumber: 13\n    }\n  }, React.createElement(Text, {\n    style: {\n      color: \"#fff\",\n      fontSize: 20\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 428,\n      columnNumber: 15\n    }\n  }, \"Re-take\")), React.createElement(TouchableOpacity, {\n    onPress: savePhoto,\n    style: {\n      width: 130,\n      height: 40,\n      alignItems: \"center\",\n      borderRadius: 4\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 437,\n      columnNumber: 13\n    }\n  }, React.createElement(Text, {\n    style: {\n      color: \"#fff\",\n      fontSize: 20\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 447,\n      columnNumber: 15\n    }\n  }, \"save photo\"))))));\n};","map":{"version":3,"sources":["/Users/alvinneri/Desktop/Projects/PMS Mobile/property-management-mobile/employee-app/screens/maintenance/reportmaintenance.js"],"names":["StatusBar","React","useState","Camera","AsyncStorage","useEffect","moment","firebase","db","storage","useNavigation","useDispatch","useSelector","setLoading","useForm","Controller","useTheme","TextInput","Button","widthPercentageToDP","wp","heightPercentageToDP","hp","Toast","CarouselComponent","camera","ReportMaintenanceScreen","colors","startCamera","setStartCamera","previewVisible","setPreviewVisible","capturedImage","setCapturedImage","Constants","Type","back","cameraType","setCameraType","flashMode","setFlashMode","state","public","user","description","setDescription","subject","setSubject","photos","setPhotos","navigation","dispatch","__startCamera","requestPermissionsAsync","status","console","log","Alert","alert","__takePicture","takePictureAsync","photo","__retakePicture","__handleFlashMode","__switchCamera","__savePhoto","_photos","push","onSubmit","values","_downdloadUrls","date","Date","filename","getDate","getMonth","getFullYear","getHours","getMinutes","getSeconds","forEach","item","index","fetch","uri","then","res","blob","file","File","type","uploadTask","ref","child","invitedBy","put","on","TaskEvent","STATE_CHANGED","snapshot","progress","bytesTransferred","totalBytes","TaskState","RUNNING","error","code","getDownloadURL","downloadURL","length","_values","condoId","trim","reporterUid","uid","reporterName","firstName","lastName","image","collection","add","docRef","show","position","text1","e","styles","container","flex","width","height","r","backgroundColor","flexDirection","left","top","justifyContent","borderRadius","fontSize","marginTop","bottom","padding","alignSelf","alignItems","marginBottom","value","primary","color","fontWeight","textAlign","alignContent","StyleSheet","create","CameraPreview","retakePicture","savePhoto"],"mappings":"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","sourcesContent":["import { StatusBar } from \"expo-status-bar\";\nimport React, { useState } from \"react\";\nimport {\n  StyleSheet,\n  Text,\n  View,\n  TouchableOpacity,\n  Alert,\n  ImageBackground,\n  Image,\n} from \"react-native\";\nimport { Camera } from \"expo-camera\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { useEffect } from \"react\";\nimport moment from \"moment\";\nimport firebase from \"../../firebase/config\";\nimport { db, storage } from \"../../firebase/config\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { setLoading } from \"../../redux/public/actions\";\nimport { useForm, Controller } from \"react-hook-form\";\nimport { useTheme, TextInput, Button } from \"react-native-paper\";\nimport {\n  widthPercentageToDP as wp,\n  heightPercentageToDP as hp,\n} from \"react-native-responsive-screen\";\nimport Toast from \"react-native-toast-message\";\nimport { CarouselComponent } from \"../../components/carousel\";\n\nlet camera;\nexport default function ReportMaintenanceScreen() {\n  const { colors } = useTheme();\n  const [startCamera, setStartCamera] = useState(false);\n  const [previewVisible, setPreviewVisible] = useState(false);\n  const [capturedImage, setCapturedImage] = useState(null);\n  const [cameraType, setCameraType] = useState(Camera.Constants.Type.back);\n  const [flashMode, setFlashMode] = useState(\"off\");\n  const { user } = useSelector((state) => state.public);\n  const [description, setDescription] = useState(\"\");\n  const [subject, setSubject] = useState(\"\");\n  const [photos, setPhotos] = useState([]);\n  const navigation = useNavigation();\n  const dispatch = useDispatch();\n\n  const __startCamera = async () => {\n    const { status } = await Camera.requestPermissionsAsync();\n    console.log(status);\n    if (status === \"granted\") {\n      setStartCamera(true);\n    } else {\n      Alert.alert(\"Access denied\");\n    }\n  };\n  const __takePicture = async () => {\n    const photo = await camera.takePictureAsync();\n    setPreviewVisible(true);\n    //setStartCamera(false)\n    setCapturedImage(photo);\n  };\n\n  const __retakePicture = () => {\n    setCapturedImage(null);\n    setPreviewVisible(false);\n    __startCamera();\n  };\n  const __handleFlashMode = () => {\n    if (flashMode === \"on\") {\n      setFlashMode(\"off\");\n    } else if (flashMode === \"off\") {\n      setFlashMode(\"on\");\n    } else {\n      setFlashMode(\"auto\");\n    }\n  };\n  const __switchCamera = () => {\n    if (cameraType === \"back\") {\n      setCameraType(\"front\");\n    } else {\n      setCameraType(\"back\");\n    }\n  };\n\n  const __savePhoto = async () => {\n    setPreviewVisible(false);\n    setStartCamera(false);\n    let _photos = [...photos];\n    _photos.push(capturedImage);\n    console.log(_photos);\n    setPhotos(_photos);\n  };\n\n  const onSubmit = async (values) => {\n    console.log(values);\n    dispatch(setLoading(true));\n\n    try {\n      let _downdloadUrls = [];\n      const date = new Date();\n      const filename = `${date.getDate()}_${date.getMonth()}_${date.getFullYear()}_${date.getHours()}_${date.getMinutes()}_${date.getSeconds()}`;\n\n      photos.forEach((item, index) => {\n        fetch(item.uri)\n          .then((res) => res.blob())\n          .then((blob) => {\n            const file = new File([blob], \"File name\", { type: \"image/png\" });\n            const uploadTask = storage\n              .ref()\n              .child(`/maintenance/${user.invitedBy}/${filename}_${index}`)\n              .put(file);\n\n            uploadTask.on(\n              firebase.storage.TaskEvent.STATE_CHANGED,\n              (snapshot) => {\n                const progress =\n                  (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n                console.log(`Progress: ${progress}%`);\n                if (snapshot.state === firebase.storage.TaskState.RUNNING) {\n                  console.log(\"file uploading...\");\n                }\n                // ...etc\n              },\n              (error) => console.log(error.code),\n              async () => {\n                const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();\n                _downdloadUrls.push(downloadURL);\n                if (index === photos.length - 1) {\n                  const _values = {\n                    condoId: user.invitedBy.trim(),\n                    reporterUid: user.uid,\n                    reporterName: `${user.firstName} ${user.lastName}`,\n                    subject: subject,\n                    description: description,\n                    image: _downdloadUrls,\n                    date: new Date(),\n                    status: \"OPEN\",\n                  };\n\n                  console.log(_values);\n\n                  db.collection(\"maintenance\")\n                    .add(_values)\n                    .then((docRef) => {\n                      setStartCamera(false);\n                      setCapturedImage(null);\n                      setPhotos([]);\n                      setDescription(\"\");\n                      Toast.show({\n                        position: \"bottom\",\n                        text1: \"Report successfully submitted. \",\n                      });\n                      dispatch(setLoading(false));\n                    });\n                }\n              }\n            );\n          });\n      });\n    } catch (e) {\n      dispatch(setLoading(false));\n      console.log(e);\n    }\n  };\n\n  return (\n    <View style={styles.container}>\n      {startCamera ? (\n        <View\n          style={{\n            flex: 1,\n            width: \"100%\",\n            height: \"100%\",\n          }}\n        >\n          {previewVisible && capturedImage ? (\n            <CameraPreview\n              photo={capturedImage}\n              savePhoto={__savePhoto}\n              retakePicture={__retakePicture}\n            />\n          ) : (\n            <Camera\n              type={cameraType}\n              flashMode={flashMode}\n              style={{ flex: 1 }}\n              ref={(r) => {\n                camera = r;\n              }}\n            >\n              <View\n                style={{\n                  flex: 1,\n                  width: \"100%\",\n                  height: \"100%\",\n                  backgroundColor: \"transparent\",\n                  flexDirection: \"row\",\n                }}\n              >\n                <View\n                  style={{\n                    position: \"absolute\",\n                    left: \"5%\",\n                    top: \"10%\",\n                    flexDirection: \"column\",\n                    justifyContent: \"space-between\",\n                  }}\n                >\n                  <TouchableOpacity\n                    onPress={__handleFlashMode}\n                    style={{\n                      backgroundColor: flashMode === \"off\" ? \"#000\" : \"#fff\",\n                      borderRadius: \"50%\",\n                      height: 25,\n                      width: 25,\n                    }}\n                  >\n                    <Text\n                      style={{\n                        fontSize: 20,\n                      }}\n                    >\n                      ⚡️\n                    </Text>\n                  </TouchableOpacity>\n                  <TouchableOpacity\n                    onPress={__switchCamera}\n                    style={{\n                      marginTop: 20,\n                      borderRadius: \"50%\",\n                      height: 25,\n                      width: 25,\n                    }}\n                  >\n                    <Text\n                      style={{\n                        fontSize: 20,\n                      }}\n                    >\n                      {cameraType === \"front\" ? \"🤳\" : \"📷\"}\n                    </Text>\n                  </TouchableOpacity>\n                </View>\n                <View\n                  style={{\n                    position: \"absolute\",\n                    bottom: 0,\n                    flexDirection: \"row\",\n                    flex: 1,\n                    width: \"100%\",\n                    padding: 20,\n                    justifyContent: \"space-between\",\n                  }}\n                >\n                  <View\n                    style={{\n                      alignSelf: \"center\",\n                      flex: 1,\n                      alignItems: \"center\",\n                    }}\n                  >\n                    <TouchableOpacity\n                      onPress={__takePicture}\n                      style={{\n                        width: 70,\n                        height: 70,\n                        bottom: 0,\n                        borderRadius: 50,\n                        backgroundColor: \"#ffffff\",\n                      }}\n                    />\n                  </View>\n                </View>\n              </View>\n            </Camera>\n          )}\n        </View>\n      ) : (\n        <View\n          style={{\n            flex: 1,\n            alignItems: \"center\",\n          }}\n        >\n          <TextInput\n            autoCapitalize=\"none\"\n            name=\"Subject\"\n            mode=\"outlined\"\n            label=\"Subject\"\n            style={{\n              width: wp(\"95%\"),\n              marginBottom: 5,\n              padding: 10,\n              fontSize: 20,\n            }}\n            onChangeText={(value) => setSubject(value)}\n            value={subject}\n          />\n\n          <TextInput\n            autoCapitalize=\"none\"\n            multiline={true}\n            name=\"Description\"\n            mode=\"outlined\"\n            label=\"Description\"\n            numberOfLines={4}\n            style={{\n              height: hp(\"10%\"),\n              width: wp(\"95%\"),\n              marginBottom: 5,\n              padding: 10,\n              fontSize: 20,\n            }}\n            onChangeText={(value) => setDescription(value)}\n            value={description}\n          />\n\n          <TouchableOpacity\n            onPress={__startCamera}\n            style={{\n              width: 130,\n              borderRadius: 4,\n              backgroundColor: colors.primary,\n              flexDirection: \"row\",\n              justifyContent: \"center\",\n              alignItems: \"center\",\n              height: 40,\n            }}\n          >\n            <Text\n              style={{\n                color: \"#fff\",\n                fontWeight: \"bold\",\n                textAlign: \"center\",\n              }}\n            >\n              Take picture\n            </Text>\n          </TouchableOpacity>\n        </View>\n      )}\n      {photos.length !== 0 && !previewVisible && !startCamera && (\n        <>\n          <View\n            style={{\n              backgroundColor: \"transparent\",\n              width: \"100%\",\n              height: hp(\"40%\"),\n              justifyContent: \"center\",\n              alignContent: \"center\",\n              marginTop: 30,\n              alignItems: \"center\",\n            }}\n          >\n            <CarouselComponent photos={photos} />\n          </View>\n          {description && subject ? (\n            photos.length !== 0 ? (\n              <Button\n                mode=\"outline\"\n                style={{\n                  width: 300,\n                  marginBottom: 10,\n                  padding: 10,\n                  backgroundColor: colors.primary,\n                }}\n                onPress={onSubmit}\n              >\n                <Text style={{ color: \"#ffffff\" }}>SUBMIT</Text>\n              </Button>\n            ) : null\n          ) : null}\n        </>\n      )}\n\n      <StatusBar style=\"auto\" />\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: \"#fff\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n});\n\nconst CameraPreview = ({ photo, retakePicture, savePhoto }) => {\n  return (\n    <View\n      style={{\n        backgroundColor: \"transparent\",\n        flex: 1,\n        width: \"100%\",\n        height: \"100%\",\n      }}\n    >\n      <ImageBackground\n        source={{ uri: photo && photo.uri }}\n        style={{\n          flex: 1,\n        }}\n      >\n        <View\n          style={{\n            flex: 1,\n            flexDirection: \"column\",\n            padding: 15,\n            justifyContent: \"flex-end\",\n          }}\n        >\n          <View\n            style={{\n              flexDirection: \"row\",\n              justifyContent: \"space-between\",\n            }}\n          >\n            <TouchableOpacity\n              onPress={retakePicture}\n              style={{\n                width: 130,\n                height: 40,\n\n                alignItems: \"center\",\n                borderRadius: 4,\n              }}\n            >\n              <Text\n                style={{\n                  color: \"#fff\",\n                  fontSize: 20,\n                }}\n              >\n                Re-take\n              </Text>\n            </TouchableOpacity>\n            <TouchableOpacity\n              onPress={savePhoto}\n              style={{\n                width: 130,\n                height: 40,\n\n                alignItems: \"center\",\n                borderRadius: 4,\n              }}\n            >\n              <Text\n                style={{\n                  color: \"#fff\",\n                  fontSize: 20,\n                }}\n              >\n                save photo\n              </Text>\n            </TouchableOpacity>\n          </View>\n        </View>\n      </ImageBackground>\n    </View>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}